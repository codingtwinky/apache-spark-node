#!/usr/bin/env node

'use strict';

var fs = require('fs');
var path = require('path');

process.title = 'spark-node';

var repl = require('repl');

var spark = require('../lib/spark');
var args = process.argv.slice(2); // remove 'node spark-node'

var assembly_jar = process.env.ASSEMBLY_JAR;

if (typeof assembly_jar != 'string' || !fs.statSync(path.join(assembly_jar)).isFile()) {
    console.error("Error: ASSEMBLY_JAR environment variable does not contain valid path");
    process.exit(1);
}

// make sc and sqlContext globally accessible (like pyspark and spark-shell)
global.sc = spark.sparkContext(args, assembly_jar);
global.sqlContext= spark.sqlContext(args, assembly_jar);
global.sqlFunctions = spark.sqlFunctions();

repl.start({
    prompt: 'spark-node> ',
    input: process.stdin,
    output: process.stdout
});


